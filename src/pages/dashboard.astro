---
import Layout from "../layouts/BaseLayout.astro";
import { getAuth } from "firebase-admin/auth";
import { app } from "../firebase/server";

const auth = getAuth(app);

// Verificar la sesi√≥n actual
const sessionCookie = Astro.cookies.get("__session");
if (!sessionCookie) {
  return Astro.redirect("/index");
}

const decodedCookie = await auth.verifySessionCookie(sessionCookie.value);
let user;
if (decodedCookie) {
  try {
    user = await auth.getUser(decodedCookie.uid);
  } catch (error) {
    console.error("Error al obtener el usuario:", error);
    return Astro.redirect("/signin");
  }
}

if (!user) {
  return Astro.redirect("/signin");
}
---

<Layout title="Dashboard">
  <div class="mx-auto">
    <h1>Welcome, {user.displayName || "User"}!</h1>

  </div>
  <p class="mx-auto">Your email: {user.email}</p>
</Layout>